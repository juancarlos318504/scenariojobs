import{r as t,C as L,A as D,u as A,a as x,j as e,as as F,I as B,b as H,aB as M,p as k,M as E,G as d,T as v,aD as P,S as N,aC as R,ag as U,at as V,F as J,au as K}from"./index-f9bb7ea9.js";import{A as Q}from"./index-0ab46841.js";import{A as T}from"./ActionDelete-ad353abc.js";import{D as O}from"./DeleteOutlined-7b477e57.js";import{I as X}from"./formik.esm-14770be2.js";import{T as Y}from"./TextField-8e377cd8.js";import{M as Z}from"./Select-460c312c.js";import{L as W}from"./LoadingButton-32646a69.js";import{P as ee}from"./PlusOutlined-b5d56ac2.js";import{S as se}from"./SaveOutlined-03b01562.js";import"./OutlinedInput-2363943f.js";import"./FormControl-d662ece9.js";const te=({idCompetenciaAssessment:o,nombreCompetencia:a,onFinish:c,urlDelete:r,actionDelete:g,dataDelete:S})=>{const{openAlert:u}=t.useContext(L),{token:_}=t.useContext(D),{data:m,isLoading:C,hasError:h,postAWS:i}=A(),l=()=>{u("Por favor confirma que deseas eliminar la competencia: "+a,"warning",e(T,{callback:w}))},w=async()=>{const f=await i(r,g,S,_);f.success?u(f.message,"success"):u(`${f.message}: ${f.error}`,"error"),c()};return x("div",{style:{display:"flex",justifyContent:"flex-end"},children:[e(F,{title:"Configurar momentos y preguntas",children:e(B,{"aria-label":"delete",color:"primary",component:H,to:"competencia/"+o,children:e(M,{})})}),e(F,{title:"Eliminar Competencia",children:e(B,{"aria-label":"delete",color:"error",onClick:l,children:e(O,{})})})]})},j=({skillID:o,skillName:a,onEndAction:c,numberMoments:r=0})=>(t.useState(o),t.useState(a),e(E,{sx:{my:1,height:"100%"},children:x(d,{container:!0,spacing:{md:2,xs:1},sx:{width:"100%"},children:[x(d,{item:!0,xs:12,md:8,children:[e(v,{variant:"h6",children:a}),e(v,{variant:"caption",color:"textSecondary",children:r==1?`${r} momento configurado`:`${r} momentos configurados`})]}),e(d,{item:!0,xs:12,md:4,children:e(te,{idCompetenciaAssessment:o,nombreCompetencia:a,onFinish:c,urlDelete:"https://aivx2bpza7.execute-api.us-east-1.amazonaws.com/prod/assessments",actionDelete:"delete_skill_from_assessment",dataDelete:{id_competencia_assessment:o}})})]})}));j.prototypes={skillID:k.string.isRequired,skillName:k.string.isRequired,expandedAccordion:k.string.isRequired,handleChange:k.func.isRequired};const G=({idAssessment:o="",onAddSkill:a})=>{const[c,r]=t.useState(""),[g,S]=t.useState([]),{token:u,userData:_}=t.useContext(D),{openAlert:m}=t.useContext(L),{data:C,isLoading:h,hasError:i,postAWS:l}=A(),{data:w,isLoading:f,hasError:p,postAWS:b}=A();let{assessment_id:z}=P();const q=async()=>{const s=await l("https://aivx2bpza7.execute-api.us-east-1.amazonaws.com/prod/assessments","get_all_skills",{id_usuario_administrador:_.id,cantidad_por_pagina:50,pagina:1},u);if(s)if(s.success){if(s.data&&s.data.competencias){const n=s.data.competencias;n.length>0?S(n):S([])}}else s.message},I=async()=>{const s={id_assessment:z,id_competencia:c,id_usuario_administrador:_.id},n=await b("https://aivx2bpza7.execute-api.us-east-1.amazonaws.com/prod/assessments","add_skill_to_assessment",s,u);if(!n){m("Lo sentimos, ha ocurrido un error al intentar agregar la competencia","error");return}n.success?(m(n.message,"success"),a()):m(`${n.message}: ${n.error}`,"error")},$=s=>{const n=s.target.value;r(n)};return t.useEffect(()=>{q()},[]),x(d,{item:!0,container:!0,xs:12,md:12,spacing:2,children:[e(d,{item:!0,xs:12,md:8,children:x(N,{spacing:1,children:[e(X,{htmlFor:"skill-form",children:"Selecciona la competencia que deseas evaluar"}),e(Y,{id:"skill-form",select:!0,name:"assessment",value:c,onChange:$,children:g.map(s=>e(Z,{value:s.id,children:s.nombre},s.id))})]})}),e(d,{item:!0,xs:12,md:4,sx:{display:"flex",alignItems:"flex-end"},children:e(W,{disableElevation:!0,disabled:c=="",fullWidth:!0,size:"large",variant:"outlined",color:"primary",onClick:I,loading:f||h,loadingPosition:"start",startIcon:e(ee,{}),children:"Agregar competencia"})})]})};G.prototypes={setSkillID:k.func.isRequired,setSkillName:k.func.isRequired};function ae(){t.useState(!1);const[o,a]=t.useState([]),{token:c,userData:r}=t.useContext(D),{openAlert:g}=t.useContext(L),{data:S,isLoading:u,hasError:_,postAWS:m}=A();let{assessment_id:C}=P();const h=async()=>{const i=await m("https://aivx2bpza7.execute-api.us-east-1.amazonaws.com/prod/assessments","get_all_skill_of_assessment",{id_assessment:C},c);if(!i){g("Lo sentimos, ha ocurrido un error al intentar obtener las competencias que has agregado en tu assessment","error");return}if(i.success){if(i.data&&i.data.competencias){const l=i.data.competencias;l.length>0?a(l):a([])}}else i.message&&g(`${i.message}: ${i.error}`,"error")};return t.useEffect(()=>{h()},[]),e(d,{item:!0,xs:12,md:12,children:x(E,{title:"Competencias",children:[e(G,{onAddSkill:h}),e(R,{sx:{my:3}}),o.length<=0?e(v,{variant:"h6",color:"textSecondary",children:"Aún no se han agregado competencias para evaluar..."}):o.map((i,l)=>e(j,{skillID:i.id,skillName:i.nombre,numberMoments:i.cantidad_momentos,onEndAction:h},l))]})})}const fe=()=>{const{token:o}=t.useContext(D),{openAlert:a}=t.useContext(L);let{assessment_id:c}=P();const{data:r,isLoading:g,hasError:S,postAWS:u}=A(),{data:_,isLoading:m,hasError:C,postAWS:h}=A(),{data:i,isLoading:l,hasError:w,postAWS:f}=A(),[p,b]=t.useState(null),z=U(),q=async s=>{await u("https://aivx2bpza7.execute-api.us-east-1.amazonaws.com/prod/assessments","get_assessment",{id:c},o)},I=async()=>{const s=async()=>{const n=await f("https://aivx2bpza7.execute-api.us-east-1.amazonaws.com/prod/assessments","delete_assessment",{id:c},o);n.success?(a(n.message,"success"),z("/assessments")):a(`${n.message}: ${n.error}`,"error")};a("Por favor confirma que deseas eliminar el assessment: "+r.data.nombre,"warning",e(T,{callback:s}))},$=async s=>{const n={...s,id:c},y=await h("https://aivx2bpza7.execute-api.us-east-1.amazonaws.com/prod/assessments","update_assessment",n,o);y.success?a(y.message,"success"):a(`${y.message}: ${y.error}`,"error")};return t.useEffect(()=>{if(!r)return;if(!r.success){a(`${r.message}: ${r.error}`,"error"),b({error:"Lo sentimos, no se ha podido acceder a la información de este assessment"});return}const s=r.data;b({assessmentname:s.nombre,assessmentdescription:s.descripcion})},[r]),t.useEffect(()=>{q()},[]),g||!p?x(E,{title:"Detalles del cargo",returnButton:!0,children:[e(V,{}),e(v,{sx:{width:"100%",textAlign:"left",fontWeight:"medium"},children:"Cargando..."})]}):e(J,{children:e(E,{title:p.error?"Sin información para la competencia":`Detalles del assessment: ${p==null?void 0:p.assessmentname}`,returnButton:!0,children:p.error?e(K,{severity:"info",children:p.error}):x(Q,{...p,handleSubmitParent:$,children:[e(d,{item:!0,xs:12,sx:{mt:3,mb:0},children:e(v,{variant:"body1",children:"Elige las competencias que quieres evaluar en este assessment"})}),e(ae,{}),e(d,{item:!0,xs:12,sx:{mt:3},children:e(R,{})}),e(d,{item:!0,xs:12,md:6,children:e(W,{type:"submit",disableElevation:!0,disabled:m||l,fullWidth:!0,size:"large",variant:"contained",color:"primary",loading:m,loadingPosition:"start",startIcon:e(se,{}),children:"Guardar"})}),e(d,{item:!0,xs:12,md:6,children:e(W,{disableElevation:!0,disabled:m||l,fullWidth:!0,size:"large",variant:"contained",color:"error",onClick:I,loading:l,loadingPosition:"start",startIcon:e(O,{}),children:"Eliminar"})})]})})})};export{fe as default};
